

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pds.naif_pds4_bundler.utils.files &mdash; NAIF PDS4 Bundler 1.2.2
 documentation</title>
  

  
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../../index.html" class="icon icon-home" alt="Documentation Home"> NAIF PDS4 Bundler
          

          
          </a>

          
            
            
              <div class="version">
                1.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../10_overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../20_spice_kernel_archive_description.html">SPICE Kernel Archive Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../30_spice_kernel_archive_preparation_guide.html">SPICE Kernel Archive Preparation Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../40_naif_pds4_bundler_user_guide.html">NAIF PDS4 Bundler User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../50_api_docs.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../60_annex_npb_for_pds3.html">Appendix: NPB for PDS3 Archives</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">NAIF PDS4 Bundler</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
      <li>pds.naif_pds4_bundler.utils.files</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pds.naif_pds4_bundler.utils.files</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;File and Text Management Functions to support NPB Classes.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">difflib</span>
<span class="kn">import</span> <span class="nn">errno</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>

<span class="kn">import</span> <span class="nn">spiceypy</span>

<span class="kn">from</span> <span class="nn">..classes.log</span> <span class="kn">import</span> <span class="n">error_message</span>


<div class="viewcode-block" id="etree_to_dict"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.etree_to_dict">[docs]</a><span class="k">def</span> <span class="nf">etree_to_dict</span><span class="p">(</span><span class="n">etree</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert between XML and JSON.</span>

<span class="sd">    The following XML-to-Python-dict snippet parses entities as well as</span>
<span class="sd">    attributes following this XML-to-JSON &quot;specification&quot;. It is the most</span>
<span class="sd">    general solution handling all cases of XML.</span>

<span class="sd">    https://www.xml.com/pub/a/2006/05/31/converting-between-xml-and-json.html</span>

<span class="sd">    :param etree: Element Tree read from XML file</span>
<span class="sd">    :type etree: dict</span>
<span class="sd">    :return: XML File converted into a JSON file</span>
<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">jtree</span> <span class="o">=</span> <span class="p">{</span><span class="n">etree</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">etree</span><span class="o">.</span><span class="n">attrib</span> <span class="k">else</span> <span class="kc">None</span><span class="p">}</span>
    <span class="n">children</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">etree</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">children</span><span class="p">:</span>
        <span class="n">dd</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dc</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="n">etree_to_dict</span><span class="p">,</span> <span class="n">children</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dc</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">dd</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">jtree</span> <span class="o">=</span> <span class="p">{</span><span class="n">etree</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dd</span><span class="o">.</span><span class="n">items</span><span class="p">()}}</span>
    <span class="k">if</span> <span class="n">etree</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
        <span class="n">jtree</span><span class="p">[</span><span class="n">etree</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="s2">&quot;@&quot;</span> <span class="o">+</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">etree</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">etree</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">children</span> <span class="ow">or</span> <span class="n">etree</span><span class="o">.</span><span class="n">attrib</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
                <span class="n">jtree</span><span class="p">[</span><span class="n">etree</span><span class="o">.</span><span class="n">tag</span><span class="p">][</span><span class="s2">&quot;#text&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">jtree</span><span class="p">[</span><span class="n">etree</span><span class="o">.</span><span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">text</span>

    <span class="k">return</span> <span class="n">jtree</span></div>


<div class="viewcode-block" id="md5"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.md5">[docs]</a><span class="k">def</span> <span class="nf">md5</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Returns the MD5 sum (checksum) of the provided file.</span>

<span class="sd">    :param fname: Filename</span>
<span class="sd">    :type fname: str</span>
<span class="sd">    :return: Checksum value of the file</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hash_md5</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">iter</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">4096</span><span class="p">),</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
            <span class="n">hash_md5</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">hash_md5</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span></div>


<div class="viewcode-block" id="copy"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.copy">[docs]</a><span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a directory and raises an error if the directory exists.</span>

<span class="sd">    :param src: Source directory with path.</span>
<span class="sd">    :type src: str</span>
<span class="sd">    :param dest: Destination directory with path.</span>
<span class="sd">    :type dest: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1">#</span>
        <span class="c1"># If the error was caused because the source was not a directory.</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">ENOTDIR</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dest</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;-- Directory </span><span class="si">{</span><span class="n">src</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> not &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;copied, probably because the increment &quot;</span>
                <span class="s2">&quot;directory exists.</span><span class="se">\n</span><span class="s2"> Error: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span>
            <span class="p">)</span></div>


<div class="viewcode-block" id="safe_make_directory"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.safe_make_directory">[docs]</a><span class="k">def</span> <span class="nf">safe_make_directory</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Creates a directory if not present.</span>

<span class="sd">    :param dir: Directory path.</span>
<span class="sd">    :type dir: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-- Generated directory: </span><span class="si">{</span><span class="nb">dir</span><span class="si">}</span><span class="s2">  &quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="extension_to_type"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.extension_to_type">[docs]</a><span class="k">def</span> <span class="nf">extension_to_type</span><span class="p">(</span><span class="n">kernel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a SPICE kernel provide the SPICE kernel type.</span>

<span class="sd">    :param kernel: SPICE Kernel name</span>
<span class="sd">    :type kernel: str</span>
<span class="sd">    :return: SPICE Kernel type of the input SPICE kernel name</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kernel_type_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;TI&quot;</span><span class="p">:</span> <span class="s2">&quot;IK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TF&quot;</span><span class="p">:</span> <span class="s2">&quot;FK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TM&quot;</span><span class="p">:</span> <span class="s2">&quot;MK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TSC&quot;</span><span class="p">:</span> <span class="s2">&quot;SCLK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TLS&quot;</span><span class="p">:</span> <span class="s2">&quot;LSK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TPC&quot;</span><span class="p">:</span> <span class="s2">&quot;PCK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BC&quot;</span><span class="p">:</span> <span class="s2">&quot;CK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BSP&quot;</span><span class="p">:</span> <span class="s2">&quot;SPK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BPC&quot;</span><span class="p">:</span> <span class="s2">&quot;PCK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BES&quot;</span><span class="p">:</span> <span class="s2">&quot;EK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BDS&quot;</span><span class="p">:</span> <span class="s2">&quot;DSK&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ORB&quot;</span><span class="p">:</span> <span class="s2">&quot;ORB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NRB&quot;</span><span class="p">:</span> <span class="s2">&quot;ORB&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1">#</span>
        <span class="c1"># Kernel is an object</span>
        <span class="c1">#</span>
        <span class="n">kernel_type</span> <span class="o">=</span> <span class="n">kernel_type_map</span><span class="p">[</span><span class="n">kernel</span><span class="o">.</span><span class="n">extension</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
        <span class="c1">#</span>
        <span class="c1"># Kernel is a string</span>
        <span class="c1">#</span>
        <span class="n">kernel_type</span> <span class="o">=</span> <span class="n">kernel_type_map</span><span class="p">[</span><span class="n">kernel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">kernel_type</span></div>


<div class="viewcode-block" id="type_to_pds3_type"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.type_to_pds3_type">[docs]</a><span class="k">def</span> <span class="nf">type_to_pds3_type</span><span class="p">(</span><span class="n">kernel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a SPICE kernel provide the PDS3 SPICE kernel type.</span>

<span class="sd">    :param kernel: SPICE Kernel name</span>
<span class="sd">    :type kernel: str</span>
<span class="sd">    :return: PDS3 SPICE Kernel type of the input SPICE kernel name</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kernel_type_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;IK&quot;</span><span class="p">:</span> <span class="s2">&quot;INSTRUMENT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FK&quot;</span><span class="p">:</span> <span class="s2">&quot;FRAMES&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SCLK&quot;</span><span class="p">:</span> <span class="s2">&quot;CLOCK_COEFFICIENTS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LSK&quot;</span><span class="p">:</span> <span class="s2">&quot;LEAPSECONDS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PCK&quot;</span><span class="p">:</span> <span class="s2">&quot;TARGET_CONSTANTS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CK&quot;</span><span class="p">:</span> <span class="s2">&quot;POINTING&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SPK&quot;</span><span class="p">:</span> <span class="s2">&quot;EPHEMERIS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DSK&quot;</span><span class="p">:</span> <span class="s2">&quot;SHAPE&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1">#</span>
        <span class="c1"># Kernel is an object</span>
        <span class="c1">#</span>
        <span class="n">kernel_type</span> <span class="o">=</span> <span class="n">kernel_type_map</span><span class="p">[</span><span class="n">kernel</span><span class="o">.</span><span class="n">extension</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>
    <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
        <span class="c1">#</span>
        <span class="c1"># Kernel is a string</span>
        <span class="c1">#</span>
        <span class="n">kernel_type</span> <span class="o">=</span> <span class="n">kernel_type_map</span><span class="p">[</span><span class="n">kernel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>

    <span class="k">return</span> <span class="n">kernel_type</span></div>


<div class="viewcode-block" id="type_to_extension"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.type_to_extension">[docs]</a><span class="k">def</span> <span class="nf">type_to_extension</span><span class="p">(</span><span class="n">kernel_type</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Given a SPICE kernel type provide the SPICE kernel extension.</span>

<span class="sd">    :param kernel_type: SPICE kernel type</span>
<span class="sd">    :type kernel_type: str</span>
<span class="sd">    :return: SPICE Kernel extension</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kernel_type</span> <span class="o">=</span> <span class="n">kernel_type</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="n">kernel_type_map</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;IK&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;ti&quot;</span><span class="p">],</span>
        <span class="s2">&quot;FK&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;tf&quot;</span><span class="p">],</span>
        <span class="s2">&quot;MK&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;tm&quot;</span><span class="p">],</span>
        <span class="s2">&quot;SCLK&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;tsc&quot;</span><span class="p">],</span>
        <span class="s2">&quot;LSK&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;tls&quot;</span><span class="p">],</span>
        <span class="s2">&quot;PCK&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;tpc&quot;</span><span class="p">,</span> <span class="s2">&quot;bpc&quot;</span><span class="p">],</span>
        <span class="s2">&quot;CK&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bc&quot;</span><span class="p">],</span>
        <span class="s2">&quot;SPK&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bsp&quot;</span><span class="p">],</span>
        <span class="s2">&quot;DSK&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;bds&quot;</span><span class="p">],</span>
    <span class="p">}</span>

    <span class="n">kernel_extension</span> <span class="o">=</span> <span class="n">kernel_type_map</span><span class="p">[</span><span class="n">kernel_type</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">kernel_extension</span></div>


<div class="viewcode-block" id="add_carriage_return"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.add_carriage_return">[docs]</a><span class="k">def</span> <span class="nf">add_carriage_return</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">eol</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds Carriage Return (``&lt;CR&gt;``) to a line.</span>

<span class="sd">    :param line: Input line</span>
<span class="sd">    :type line: str</span>
<span class="sd">    :param eol: EOL defined by the configuration file</span>
<span class="sd">    :type eol: str</span>
<span class="sd">    :return: Input line with CR</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">eol</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="ow">and</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">eol</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="ow">and</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">error_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File has incorrect CR at line: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="n">setup</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">eol</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="ow">and</span> <span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">eol</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="ow">and</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
            <span class="n">error_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File has incorrect CR at line: </span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="n">setup</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">line</span></div>


<div class="viewcode-block" id="add_crs_to_file"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.add_crs_to_file">[docs]</a><span class="k">def</span> <span class="nf">add_crs_to_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">eol</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Adds Carriage Return (``&lt;CR&gt;``) to a file.</span>

<span class="sd">    :param line: Input file</span>
<span class="sd">    :type line: str</span>
<span class="sd">    :param eol: End of Line character as indicated by the configuration file</span>
<span class="sd">    :type eol: str</span>
<span class="sd">    :raise: If CR cannot be added to the file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">file_crs</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;crs_tmp&quot;</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_crs</span><span class="p">,</span> <span class="s2">&quot;w+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">add_carriage_return</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">eol</span><span class="p">,</span> <span class="n">setup</span><span class="p">)</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">file_crs</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
        <span class="n">error_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Carriage return adding error for </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">setup</span><span class="p">)</span></div>


<div class="viewcode-block" id="check_list_duplicates"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.check_list_duplicates">[docs]</a><span class="k">def</span> <span class="nf">check_list_duplicates</span><span class="p">(</span><span class="n">list_of_elements</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check if given list contains any duplicates.</span>

<span class="sd">    :param list_of_elements: List of SPICE kernel names</span>
<span class="sd">    :type list_of_elements: list</span>
<span class="sd">    :return: True if the input list contains</span>
<span class="sd">             duplicates, False otherwise</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">list_of_elements</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">list_of_elements</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="fill_template"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.fill_template">[docs]</a><span class="k">def</span> <span class="nf">fill_template</span><span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="n">product_file</span><span class="p">,</span> <span class="n">product_dictionary</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fill a template with uppercase keywords preceded with ``$``.</span>

<span class="sd">    :param object: List object</span>
<span class="sd">    :type object: object</span>
<span class="sd">    :param product_file: Resulting file</span>
<span class="sd">    :type product_file: str</span>
<span class="sd">    :param product_dictionary: Dictionary of keys to replace</span>
<span class="sd">    :type product_dictionary: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">product_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">object</span><span class="o">.</span><span class="n">template</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">t</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">product_dictionary</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">line</span> <span class="ow">and</span> <span class="s2">&quot;$&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;$&quot;</span> <span class="o">+</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">line</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_context_products"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.get_context_products">[docs]</a><span class="k">def</span> <span class="nf">get_context_products</span><span class="p">(</span><span class="n">setup</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Obtain PDS4 Context Products.</span>

<span class="sd">    Obtain the context products from the PDS4 registered context products</span>
<span class="sd">    template or from the XML configuration file.</span>

<span class="sd">    :param setup: Setup object already constructed</span>
<span class="sd">    :return: dictionary with the JSON structure of the bundle context products</span>
<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1"># First look into the setup object and check if the context product is</span>
    <span class="c1"># available, otherwise get it from the json file included in the</span>
    <span class="c1"># package.</span>
    <span class="c1">#</span>
    <span class="c1"># Load the default context products</span>
    <span class="c1">#</span>
    <span class="n">registered_context_products_file</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">setup</span><span class="o">.</span><span class="n">root_dir</span><span class="si">}</span><span class="s2">data/registered_context_products.json&quot;</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">registered_context_products_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">context_products</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)[</span><span class="s2">&quot;Product_Context&quot;</span><span class="p">]</span>

    <span class="c1">#</span>
    <span class="c1"># Overwrite the default context products with the ones provided in the</span>
    <span class="c1"># configuration file.</span>
    <span class="c1">#</span>
    <span class="n">appended_products</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="s2">&quot;context_products&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">setup</span><span class="o">.</span><span class="n">context_products</span><span class="p">[</span><span class="s2">&quot;product&quot;</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">context_products_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">setup</span><span class="o">.</span><span class="n">context_products</span><span class="p">[</span><span class="s2">&quot;product&quot;</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">context_products_list</span> <span class="o">=</span> <span class="n">setup</span><span class="o">.</span><span class="n">context_products</span><span class="p">[</span><span class="s2">&quot;product&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">context_products_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">product</span><span class="p">:</span>
                <span class="n">updated_product</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">registered_product</span> <span class="ow">in</span> <span class="n">context_products</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">registered_product</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">product</span><span class="p">[</span><span class="s2">&quot;@name&quot;</span><span class="p">]:</span>
                        <span class="n">updated_product</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">context_products</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">product</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]]</span>
                        <span class="n">context_products</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;lidvid&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">product</span><span class="p">[</span><span class="s2">&quot;lidvid&quot;</span><span class="p">]</span>
                    <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">updated_product</span><span class="p">:</span>
                    <span class="n">appended_products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">product</span><span class="p">[</span><span class="s2">&quot;@name&quot;</span><span class="p">]],</span>
                            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">product</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]],</span>
                            <span class="s2">&quot;lidvid&quot;</span><span class="p">:</span> <span class="n">product</span><span class="p">[</span><span class="s2">&quot;lidvid&quot;</span><span class="p">],</span>
                        <span class="p">}</span>
                    <span class="p">)</span>

    <span class="k">if</span> <span class="n">appended_products</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">appended_products</span><span class="p">:</span>
            <span class="n">context_products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># Return the context products used in the bundle.</span>
    <span class="c1">#</span>
    <span class="n">bundle_context_products</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">config_context_products</span> <span class="o">=</span> <span class="p">[</span><span class="n">setup</span><span class="o">.</span><span class="n">observer</span><span class="p">,</span> <span class="n">setup</span><span class="o">.</span><span class="n">target</span><span class="p">]</span>

    <span class="c1">#</span>
    <span class="c1"># Check the secondary s/c and if present add them to the</span>
    <span class="c1"># Configuration for context products.3</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="s2">&quot;secondary_observers&quot;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">sc</span> <span class="ow">in</span> <span class="n">setup</span><span class="o">.</span><span class="n">secondary_observers</span><span class="p">:</span>
            <span class="n">config_context_products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># Check the secondary targets and if present add them to the</span>
    <span class="c1"># Configuration for context products.3</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">setup</span><span class="p">,</span> <span class="s2">&quot;secondary_targets&quot;</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">tar</span> <span class="ow">in</span> <span class="n">setup</span><span class="o">.</span><span class="n">secondary_targets</span><span class="p">:</span>
            <span class="n">config_context_products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tar</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">context_product</span> <span class="ow">in</span> <span class="n">context_products</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">config_product</span> <span class="ow">in</span> <span class="n">config_context_products</span><span class="p">:</span>
            <span class="c1">#</span>
            <span class="c1"># For the conditional statement we need to put both names lower case.</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="n">context_product</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">config_product</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">bundle_context_products</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">context_product</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bundle_context_products</span></div>


<div class="viewcode-block" id="mk_to_list"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.mk_to_list">[docs]</a><span class="k">def</span> <span class="nf">mk_to_list</span><span class="p">(</span><span class="n">mk</span><span class="p">,</span> <span class="n">setup</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate a list of kernels from a Meta-kernel.</span>

<span class="sd">    This function assumes that the meta-kernel will contain a PATH_SYMBOLS</span>
<span class="sd">    definition that will be present in each kernel entry preceded by a dollar</span>
<span class="sd">    sign ``$``.</span>

<span class="sd">    If no kernel is found an error is raised.</span>

<span class="sd">    :param mk: Meta-kernel path from which the list of kernels is generated</span>
<span class="sd">    :type mk: str</span>
<span class="sd">    :param setup: NPB run Setup Object</span>
<span class="sd">    :type setup: object</span>
<span class="sd">    :return: List of kernels present in the meta-kernel</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">path_symbol</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">get_symbol</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">ker_mk_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mk</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">path_symbol</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">path_symbol</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">kernel</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">kernel</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path_symbol</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">kernel</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">kernel</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">kernel</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">kernel</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">kernel</span><span class="p">:</span>
                        <span class="n">ker_mk_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;PATH_SYMBOLS&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                <span class="n">get_symbol</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">get_symbol</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1">#</span>
                    <span class="c1"># General case, the value is in the same line. e.g.:</span>
                    <span class="c1">#</span>
                    <span class="c1"># PATH_SYMBOLS = ( &#39;KERNELS&#39; )</span>
                    <span class="c1">#</span>
                    <span class="c1"># but also get the VCO particular case:</span>
                    <span class="c1">#</span>
                    <span class="c1"># PATH_SYMBOLS = (</span>
                    <span class="c1"># &#39;KERNELS&#39;</span>
                    <span class="c1"># )</span>
                    <span class="c1">#</span>
                    <span class="n">path_symbol</span> <span class="o">=</span> <span class="s2">&quot;$&quot;</span> <span class="o">+</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">get_symbol</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
                    <span class="k">pass</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">ker_mk_list</span><span class="p">:</span>
        <span class="n">error_message</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;No kernels present in </span><span class="si">{</span><span class="n">mk</span><span class="si">}</span><span class="s2">. &quot;</span> <span class="sa">f</span><span class="s2">&quot;Please review MK generation.&quot;</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="n">setup</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">ker_mk_list</span></div>


<div class="viewcode-block" id="get_latest_kernel"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.get_latest_kernel">[docs]</a><span class="k">def</span> <span class="nf">get_latest_kernel</span><span class="p">(</span>
    <span class="n">kernel_type</span><span class="p">,</span> <span class="n">paths</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">dates</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">excluded_kernels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mks</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Get the latest kernel given a type and a pattern.</span>

<span class="sd">    Returns the name of the latest SPICE kernel of a given type present</span>
<span class="sd">    in the path. This function is exclusively used find the latest version</span>
<span class="sd">    of the kernels to be included in a meta-kernel.</span>

<span class="sd">    :param kernel_type: SPICE Kernel type which also defines</span>
<span class="sd">                        the subdirectory name.</span>
<span class="sd">    :type kernel_type: str</span>
<span class="sd">    :param paths: List of paths to the roots of the SPICE Kernels directories</span>
<span class="sd">                  where the kernels are store in a subdirectory named &quot;type&quot;.</span>
<span class="sd">    :type paths: str</span>
<span class="sd">    :param pattern: Patterns to search for that defines the kernel &quot;type&quot;</span>
<span class="sd">                    file naming scheme. This pattern follows the format of</span>
<span class="sd">                    the meta-kernel grammar provided in the XML configuration</span>
<span class="sd">                    file</span>
<span class="sd">    :type pattern: str</span>
<span class="sd">    :param dates: Indicates that the pattern of the kernel includes dates</span>
<span class="sd">                  and that the last version of each kernel with a date has</span>
<span class="sd">                  to be included. If this parameter is set to False then</span>
<span class="sd">                  only the latest date and latest version is included</span>
<span class="sd">    :type dates: bool</span>
<span class="sd">    :param excluded_kernels: Indicates that a specific kernel might have</span>
<span class="sd">                             to be excluded from the search.</span>
<span class="sd">    :type excluded_kernels: list</span>
<span class="sd">    :param mks: Indicates that the kernels present in the list of provided</span>
<span class="sd">          meta-kernels have to be included for consideration to obtain</span>
<span class="sd">          the latest version of the given kernel</span>
<span class="sd">    :type mks: list</span>
<span class="sd">    :return: Name of the latest kernels as specified by the pattern.</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kernels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">kernels_with_path</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">kernel_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">kernel_type</span><span class="p">)</span>
            <span class="c1">#</span>
            <span class="c1"># Get the kernels of type `type&#39; from the `path`&#39;/`type`</span>
            <span class="c1"># directory.</span>
            <span class="c1">#</span>
            <span class="n">kernels_with_path</span> <span class="o">+=</span> <span class="p">[</span>
                <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">kernel_path</span><span class="si">}</span><span class="s2">/&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">if</span> <span class="n">mks</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">mk</span> <span class="ow">in</span> <span class="n">mks</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mk</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">m</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">line</span><span class="p">):</span>
                        <span class="n">kernels_with_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="n">kernels_with_path</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">kernels_with_path</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">kernel</span> <span class="ow">in</span> <span class="n">kernels_with_path</span><span class="p">:</span>
        <span class="n">kernel</span> <span class="o">=</span> <span class="n">kernel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;&#39;&quot;</span> <span class="ow">in</span> <span class="n">kernel</span><span class="p">:</span>
            <span class="n">kernels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kernel</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kernels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># Put the kernels in order</span>
    <span class="c1">#</span>
    <span class="n">kernels</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="c1">#</span>
    <span class="c1"># Remove the kernel if it is included in the excluded kernels list</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">excluded_kernels</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">excluded_kernel</span> <span class="ow">in</span> <span class="n">excluded_kernels</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">kernel</span> <span class="ow">in</span> <span class="n">kernels</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">excluded_kernel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">kernel</span><span class="p">:</span>
                    <span class="n">kernels</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">dates</span><span class="p">:</span>
        <span class="c1">#</span>
        <span class="c1"># Return the latest kernel</span>
        <span class="c1">#</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">kernels</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;        No kernels found with pattern &quot;</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">#</span>
        <span class="c1"># Return all the kernels with a given date</span>
        <span class="c1">#</span>
        <span class="n">previous_kernel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">kernels_date</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">kernel</span> <span class="ow">in</span> <span class="n">kernels</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">previous_kernel</span>
                <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_V[0-9]*&quot;</span><span class="p">,</span> <span class="n">previous_kernel</span><span class="o">.</span><span class="n">upper</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="o">==</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_V[0-9]*&quot;</span><span class="p">,</span> <span class="n">kernel</span><span class="o">.</span><span class="n">upper</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">kernels_date</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">previous_kernel</span><span class="p">)</span>

            <span class="n">previous_kernel</span> <span class="o">=</span> <span class="n">kernel</span>
            <span class="n">kernels_date</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">kernels_date</span></div>


<div class="viewcode-block" id="check_consecutive"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.check_consecutive">[docs]</a><span class="k">def</span> <span class="nf">check_consecutive</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check if a list has consecutive numbers.</span>

<span class="sd">    Check if a list of names with enumeration include all the elements</span>
<span class="sd">    in such a way that the enumeration contains all expected numbers.</span>

<span class="sd">    :param lst: List of names that include an enumeration</span>
<span class="sd">    :type lst: list</span>
<span class="sd">    :return: Check if the list has a complete enumeration</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span></div>


<div class="viewcode-block" id="compare_files"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.compare_files">[docs]</a><span class="k">def</span> <span class="nf">compare_files</span><span class="p">(</span><span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="nb">dir</span><span class="p">,</span> <span class="n">display</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compare two files.</span>

<span class="sd">    Compares two files and provides the logic to determine whether if the</span>
<span class="sd">    comparison should be added to the log or to an individual file with the</span>
<span class="sd">    comparison. The default name of the possible resulting file is::</span>

<span class="sd">       diff_`fromfile&#39;[extension removed]_`tofile&#39;[extension_removed].html</span>

<span class="sd">    The format for the log output is ASCII and follows a simplified Unix</span>
<span class="sd">    diff format.</span>

<span class="sd">    The format for the file output is HTML and mocks a simplified Unix</span>
<span class="sd">    GUI diff tool such as tkdiff.</span>

<span class="sd">    :param fromfile: Path of first file to be compared</span>
<span class="sd">    :type fromfile: str</span>
<span class="sd">    :param tofile: Path of second file to be compared</span>
<span class="sd">    :type tofile: str</span>
<span class="sd">    :param dir: Resulting diff files destination directory</span>
<span class="sd">    :type dir: str</span>
<span class="sd">    :param display: Indication if the fie will only be written in log or</span>
<span class="sd">                    if a specific diff file will be generated</span>
<span class="sd">    :type display: str</span>
<span class="sd">    :return: True if the files are different, False if they are the same.</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">ff</span><span class="p">:</span>
        <span class="n">fromlines</span> <span class="o">=</span> <span class="n">ff</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span> <span class="k">as</span> <span class="n">tf</span><span class="p">:</span>
        <span class="n">tolines</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">fromlines</span> <span class="o">==</span> <span class="n">tolines</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;-- The following files have the same content:&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">fromfile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   </span><span class="si">{</span><span class="n">tofile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">md5</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span> <span class="o">==</span> <span class="n">md5</span><span class="p">(</span><span class="n">tofile</span><span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;   And have the same MD5Sum.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">display</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;log&quot;</span><span class="p">]:</span>

        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">Differ</span><span class="p">()</span>
        <span class="n">diff_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">diff_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;+&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;?&quot;</span><span class="p">):</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">line</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">display</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;files&quot;</span><span class="p">]:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">HtmlDiff</span><span class="p">()</span><span class="o">.</span><span class="n">make_file</span><span class="p">(</span>
            <span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">numlines</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="n">diff_html</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span>
            <span class="nb">dir</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;/diff_&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fromfile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tofile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;.html&quot;</span><span class="p">,</span>
            <span class="s2">&quot;w&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">diff_html</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
        <span class="n">diff_html</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="match_patterns"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.match_patterns">[docs]</a><span class="k">def</span> <span class="nf">match_patterns</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name_w_pattern</span><span class="p">,</span> <span class="n">patterns</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;March patterns to filename.</span>

<span class="sd">    Given a SPICE kernel name, a SPICE Kernel name with patterns, and the</span>
<span class="sd">    possible patterns, provide a dictionary with the patterns as keys and</span>
<span class="sd">    the patterns values as value after matching it between the SPICE Kernel</span>
<span class="sd">    name with patterns and without patterns.</span>

<span class="sd">    For example, given the following arguments:</span>

<span class="sd">         * name: ``insight_v01.tm``</span>
<span class="sd">         * name_w_pattern: ``insight_v$VERSION.tm``</span>

<span class="sd">    The function will return: ``{VERSION: &#39;01&#39;}``</span>

<span class="sd">    :param name: Name of the SPICE Kernel</span>
<span class="sd">    :type name: str</span>
<span class="sd">    :param name_w_pattern: Name of the SPICE Kernel with patterns</span>
<span class="sd">    :type name_w_pattern: str</span>
<span class="sd">    :param patterns: List of the possible patterns present in the</span>
<span class="sd">                     SPICE Kernel name with patterns</span>
<span class="sd">    :type patterns: list</span>
<span class="sd">    :return: Dictionary providing the patterns and their value as defined</span>
<span class="sd">             by the SPICE kernel</span>
<span class="sd">    :rtype: dict</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#</span>
    <span class="c1"># This list will help us determine the order of the patterns in the file</span>
    <span class="c1"># name because later on the patterns need to be correlated with the</span>
    <span class="c1"># pattern values.</span>
    <span class="c1">#</span>
    <span class="n">pattern_name_order</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">name_check</span> <span class="o">=</span> <span class="n">name_w_pattern</span>

    <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="n">patterns</span><span class="p">:</span>
        <span class="n">pattern_name_order</span><span class="p">[</span><span class="n">pattern</span><span class="p">[</span><span class="s2">&quot;#text&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">name_w_pattern</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">pattern</span><span class="p">[</span><span class="s2">&quot;#text&quot;</span><span class="p">])</span>
        <span class="n">name_check</span> <span class="o">=</span> <span class="n">name_check</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
            <span class="s2">&quot;$&quot;</span> <span class="o">+</span> <span class="n">pattern</span><span class="p">[</span><span class="s2">&quot;#text&quot;</span><span class="p">],</span> <span class="s2">&quot;$&quot;</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">pattern</span><span class="p">[</span><span class="s2">&quot;@length&quot;</span><span class="p">])</span>
        <span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># Convert the pattern_name_order_dictionary into an ordered lis</span>
    <span class="c1">#</span>
    <span class="n">pattern_name_order</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span> <span class="n">v</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">pattern_name_order</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="p">}</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># Generate a list of values extracted from the comparison of the</span>
    <span class="c1"># original file and the file with patterns.</span>
    <span class="c1">#</span>
    <span class="n">values_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">value_bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">name_check</span><span class="p">)):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">name_check</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">value_bool</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">name_check</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">and</span> <span class="n">value_bool</span><span class="p">:</span>
            <span class="n">value_bool</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">values_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">name_check</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;$&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">value_bool</span><span class="p">):</span>
            <span class="n">value_bool</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">value</span> <span class="o">+=</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">name_check</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;$&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value_bool</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">+=</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span>

    <span class="c1">#</span>
    <span class="c1"># Correlate the values with their position in the file name with</span>
    <span class="c1"># patterns.</span>
    <span class="c1">#</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values_list</span><span class="p">)):</span>
        <span class="n">values</span><span class="p">[</span><span class="n">pattern_name_order</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">values_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">values</span></div>


<div class="viewcode-block" id="utf8len"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.utf8len">[docs]</a><span class="k">def</span> <span class="nf">utf8len</span><span class="p">(</span><span class="n">strn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Length of a string in bytes.</span>

<span class="sd">    :param strn: string</span>
<span class="sd">    :type strn: str</span>
<span class="sd">    :return: length of string in bytes</span>
<span class="sd">    :rtype: int</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">strn</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span></div>


<div class="viewcode-block" id="kernel_name"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.kernel_name">[docs]</a><span class="k">def</span> <span class="nf">kernel_name</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;List sorting function.</span>

<span class="sd">    :param path: path to be sorted</span>
<span class="sd">    :type path: str</span>
<span class="sd">    :return: sorting result</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="checksum_from_registry"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.checksum_from_registry">[docs]</a><span class="k">def</span> <span class="nf">checksum_from_registry</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">working_directory</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extract checksum from the checksum registry.</span>

<span class="sd">    All the checksum registries will be checked.</span>

<span class="sd">    :param path: Product path</span>
<span class="sd">    :type path: str</span>
<span class="sd">    :param working_directory: checksum registry path</span>
<span class="sd">    :type working_directory: str</span>
<span class="sd">    :return: MD5 Sum for the file indicated by path</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">checksum</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">checksum_registries</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">working_directory</span><span class="si">}</span><span class="s2">/*.checksum&quot;</span><span class="p">)</span>
    <span class="n">checksum_found</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">for</span> <span class="n">checksum_registry</span> <span class="ow">in</span> <span class="n">checksum_registries</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">checksum_found</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">checksum_registry</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">lbl</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lbl</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                        <span class="n">checksum</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;-- Checksum obtained from Checksum &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;Registry file: </span><span class="si">{</span><span class="n">checksum_registry</span><span class="si">}</span><span class="s2">&quot;</span>
                        <span class="p">)</span>
                        <span class="n">checksum_found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>

    <span class="k">return</span> <span class="n">checksum</span></div>


<div class="viewcode-block" id="checksum_from_label"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.checksum_from_label">[docs]</a><span class="k">def</span> <span class="nf">checksum_from_label</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extract checksum from a label rather than calculating it.</span>

<span class="sd">    :param path: Product path</span>
<span class="sd">    :type path: str</span>
<span class="sd">    :return: MD5 Sum for the file indicated by path</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">checksum</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">product_label</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.xml&quot;</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">product_label</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">product_label</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">lbl</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lbl</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;&lt;md5_checksum&gt;&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="n">checksum</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;md5_checksum&gt;&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">checksum</span> <span class="o">=</span> <span class="n">checksum</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&lt;/md5_check&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;-- Checksum obtained from existing label:&quot;</span>
                        <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">product_label</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="k">break</span>

    <span class="k">return</span> <span class="n">checksum</span></div>


<div class="viewcode-block" id="extract_comment"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.extract_comment">[docs]</a><span class="k">def</span> <span class="nf">extract_comment</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">handle</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extract comment from SPICE DAF file.</span>

<span class="sd">    :param path: Path of SPICE kernel</span>
<span class="sd">    :type path: str</span>
<span class="sd">    :return: SPICE kernel comment</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">handle</span><span class="p">:</span>
        <span class="n">close_file</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">handle</span> <span class="o">=</span> <span class="n">spiceypy</span><span class="o">.</span><span class="n">dafopr</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">close_file</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">linlen</span> <span class="o">=</span> <span class="mi">1001</span>
    <span class="n">buffsz</span> <span class="o">=</span> <span class="mi">100000</span>

    <span class="p">(</span><span class="n">lincmt</span><span class="p">,</span> <span class="n">commnt</span><span class="p">,</span> <span class="n">done</span><span class="p">)</span> <span class="o">=</span> <span class="n">spiceypy</span><span class="o">.</span><span class="n">dafec</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">buffsz</span><span class="p">,</span> <span class="n">linlen</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lincmt</span> <span class="o">&gt;</span> <span class="n">buffsz</span><span class="p">:</span>
        <span class="n">spiceypy</span><span class="o">.</span><span class="n">dafcls</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
        <span class="n">error_message</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Comment from </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s1"> is longer than buffer size.&#39;</span><span class="p">)</span>

    <span class="c1">#</span>
    <span class="c1"># Remove empty lines at the end of the comment.</span>
    <span class="c1">#</span>
    <span class="n">lines_to_remove</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">commnt</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="n">lines_to_remove</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
            <span class="k">break</span>
    <span class="k">if</span> <span class="n">lines_to_remove</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">lines_to_remove</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">commnt</span> <span class="o">=</span> <span class="n">commnt</span><span class="p">[:</span><span class="n">lines_to_remove</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">close_file</span><span class="p">:</span>
        <span class="n">spiceypy</span><span class="o">.</span><span class="n">dafcls</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">commnt</span></div>


<div class="viewcode-block" id="string_in_file"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.string_in_file">[docs]</a><span class="k">def</span> <span class="nf">string_in_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">str_to_check</span><span class="p">,</span> <span class="n">repetitions</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check if a string is present in a file.</span>

<span class="sd">    You can also provide the number of times that string is repeated.</span>

<span class="sd">    :param file: File where the string is searched</span>
<span class="sd">    :type file: str</span>
<span class="sd">    :param str_to_check: String to search</span>
<span class="sd">    :type str_to_check: str</span>
<span class="sd">    :param repetitions: Number of repetitions, default is 1</span>
<span class="sd">    :type repetitions: int</span>
<span class="sd">    :return: True if the string is present in the file, False otherwise</span>
<span class="sd">    :rtype: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lines_with_string</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">r</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">str_to_check</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">lines_with_string</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">lines_with_string</span> <span class="o">!=</span> <span class="n">repetitions</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="replace_string_in_file"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.replace_string_in_file">[docs]</a><span class="k">def</span> <span class="nf">replace_string_in_file</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">old_string</span><span class="p">,</span> <span class="n">new_string</span><span class="p">,</span> <span class="n">setup</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Replace string in a file.</span>

<span class="sd">    :param file: File to replace the string from</span>
<span class="sd">    :type file: str</span>
<span class="sd">    :param old_string: String present in file to be substituted</span>
<span class="sd">    :type old_string: str</span>
<span class="sd">    :param new_string: String to be replaced</span>
<span class="sd">    :type new_string: str</span>
<span class="sd">    :param setup: NPB run Setup Object</span>
<span class="sd">    :type setup: object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reading_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>

    <span class="n">new_file_content</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">reading_file</span><span class="p">:</span>
        <span class="n">new_line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">old_string</span><span class="p">,</span> <span class="n">new_string</span><span class="p">)</span>
        <span class="n">new_file_content</span> <span class="o">+=</span> <span class="n">add_carriage_return</span><span class="p">(</span><span class="n">new_line</span><span class="p">,</span> <span class="n">setup</span><span class="o">.</span><span class="n">eol_pds3</span><span class="p">,</span> <span class="n">setup</span><span class="p">)</span>
    <span class="n">reading_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">writing_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;temp.file&#39;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="n">writing_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">new_file_content</span><span class="p">)</span>
    <span class="n">writing_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="s1">&#39;temp.file&#39;</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span></div>


<div class="viewcode-block" id="format_multiple_values"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.format_multiple_values">[docs]</a><span class="k">def</span> <span class="nf">format_multiple_values</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reformat multi-line key value for PDS3 labels.</span>

<span class="sd">    For example if the ``MAKLABEL`` key value has multiple entries, it needs to</span>
<span class="sd">    be reformatted.</span>

<span class="sd">    :param value: PDS3 key value</span>
<span class="sd">    :type value: str</span>
<span class="sd">    :return: PDS3 key value reformatted</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;,&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;{</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">31</span><span class="si">}{</span><span class="n">val</span><span class="si">}</span><span class="s2">,</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">*</span> <span class="mi">31</span> <span class="o">+</span> <span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="product_mapping"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.product_mapping">[docs]</a><span class="k">def</span> <span class="nf">product_mapping</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">setup</span><span class="p">,</span> <span class="n">cleanup</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Obtain the kernel mapping.</span>

<span class="sd">    :return: Kernel Mapping</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kernel_list_file</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">setup</span><span class="o">.</span><span class="n">working_directory</span>
            <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">sep</span>
            <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">setup</span><span class="o">.</span><span class="n">mission_acronym</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">setup</span><span class="o">.</span><span class="n">run_type</span><span class="si">}</span><span class="s2">_&quot;</span>
              <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">setup</span><span class="o">.</span><span class="n">release</span><span class="p">)</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">.kernel_list&quot;</span>
    <span class="p">)</span>

    <span class="n">get_map</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">kernel_list_file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">lst</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">get_map</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">get_map</span> <span class="ow">and</span> <span class="s2">&quot;MAPPING&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">mapping</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;=&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">get_map</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">cleanup</span><span class="p">:</span>
        <span class="n">setup</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="c1">#</span>
    <span class="c1"># If cleanup is not being performed this is an indication that if the kernel</span>
    <span class="c1"># mapping does not exist, this can be intentional and therefore an error</span>
    <span class="c1"># does not have to be reported.</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">mapping</span> <span class="ow">and</span> <span class="n">cleanup</span><span class="p">:</span>
        <span class="n">error_message</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> does not have mapping on </span><span class="si">{</span><span class="n">kernel_list_file</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">,</span>
            <span class="n">setup</span><span class="o">=</span><span class="n">setup</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">mapping</span></div>


<div class="viewcode-block" id="check_kernel_integrity"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.check_kernel_integrity">[docs]</a><span class="k">def</span> <span class="nf">check_kernel_integrity</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check if the SPICE Kernel has the adequate architecture.</span>

<span class="sd">    All SPICE kernels must have a NAIF file ID word as the first &quot;word&quot; on</span>
<span class="sd">    the first line of the kernel. This &quot;word&quot; describes the architecture</span>
<span class="sd">    of the kernel.</span>

<span class="sd">    A binary kernel could have the following architectures:</span>

<span class="sd">      * ``DAF``: The file is based on the DAF architecture.</span>
<span class="sd">      * ``DAS``: The file is based on the DAS architecture.</span>
<span class="sd">      * ``XFR``: The file is in a SPICE transfer file format.</span>

<span class="sd">    For an archive only ``DAF`` is acceptable.</span>

<span class="sd">    Text kernels must have ``KPL`` (Kernel Pool File) architecture.</span>

<span class="sd">    NPB checks if binary kernels have a ``DAF`` architecture and text kernels</span>
<span class="sd">    a ``KPL`` architecture.</span>

<span class="sd">    :param path: SPICE Kernel or ORBNUM path</span>
<span class="sd">    :type path: str</span>
<span class="sd">    :return: Error message if error present</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">extension</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="n">type_file</span> <span class="o">=</span> <span class="n">extension_to_type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

    <span class="c1">#</span>
    <span class="c1"># Determine if it is a binary or a text kernel.</span>
    <span class="c1">#</span>
    <span class="k">if</span> <span class="n">extension</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span>
        <span class="n">file_format</span> <span class="o">=</span> <span class="s2">&quot;Binary&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">file_format</span> <span class="o">=</span> <span class="s2">&quot;Character&quot;</span>

    <span class="c1">#</span>
    <span class="c1"># All files that are to have labels generated must have a NAIF</span>
    <span class="c1"># file ID word as the first &quot;word&quot; on the first line of the</span>
    <span class="c1"># file. Check if it is the case.</span>
    <span class="c1">#</span>
    <span class="p">(</span><span class="n">arch</span><span class="p">,</span> <span class="nb">type</span><span class="p">)</span> <span class="o">=</span> <span class="n">spiceypy</span><span class="o">.</span><span class="n">getfat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;Binary&quot;</span><span class="p">:</span>

        <span class="c1">#</span>
        <span class="c1"># A binary file could have the following architectures:</span>
        <span class="c1">#</span>
        <span class="c1">#   DAF - The file is based on the DAF architecture.</span>
        <span class="c1">#   DAS - The file is based on the DAS architecture.</span>
        <span class="c1">#   XFR - The file is in a SPICE transfer file format.</span>
        <span class="c1">#</span>
        <span class="c1"># But for an archive only DAF is acceptable.</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">arch</span> <span class="o">!=</span> <span class="s2">&quot;DAF&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">arch</span> <span class="o">!=</span> <span class="s2">&quot;DAS&quot;</span><span class="p">):</span>
            <span class="n">error</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Kernel </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> architecture </span><span class="si">{</span><span class="n">arch</span><span class="si">}</span><span class="s2"> is invalid.&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;Character&quot;</span><span class="p">:</span>

        <span class="c1">#</span>
        <span class="c1"># Text kernels must have KPL architecture:</span>
        <span class="c1">#</span>
        <span class="c1">#    KPL -- Kernel Pool File (i.e., a text kernel)</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">arch</span> <span class="o">!=</span> <span class="s2">&quot;KPL&quot;</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Kernel </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> architecture </span><span class="si">{</span><span class="n">arch</span><span class="si">}</span><span class="s2"> is invalid.&quot;</span>

    <span class="k">if</span> <span class="nb">type</span> <span class="o">!=</span> <span class="n">type_file</span><span class="p">:</span>
        <span class="n">error</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Kernel </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> type </span><span class="si">{</span><span class="n">type_file</span><span class="si">}</span><span class="s2"> is not the one expected: </span><span class="si">{</span><span class="nb">type</span><span class="si">}</span><span class="s2">.&quot;</span>

    <span class="k">return</span> <span class="n">error</span></div>


<div class="viewcode-block" id="check_binary_endianness"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.check_binary_endianness">[docs]</a><span class="k">def</span> <span class="nf">check_binary_endianness</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">endianness</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check if the SPICE Kernel has the adequate architecture.</span>

<span class="sd">    PDS4 Bundles require LTL-IEEE binary kernels and PDS3 data sets require</span>
<span class="sd">    BIG-IEEE binary kernels. This behavior can be changed via configuration.</span>

<span class="sd">    This method ensures that the endianness of binary kernels is the</span>
<span class="sd">    appropriate one according to the configuration.</span>

<span class="sd">    :param path: Binary SPICE kernel path</span>
<span class="sd">    :type path: str</span>
<span class="sd">    :param endianness: Expected Binary file endianness</span>
<span class="sd">    :type endianness: str</span>
<span class="sd">    :return: Error message if error present</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;bds&quot;</span><span class="p">:</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;das&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="s1">&#39;daf&#39;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">arch</span> <span class="o">==</span> <span class="s1">&#39;daf&#39;</span><span class="p">:</span>
            <span class="n">handle</span> <span class="o">=</span> <span class="n">spiceypy</span><span class="o">.</span><span class="n">dafopw</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">arch</span> <span class="o">==</span> <span class="s1">&#39;das&#39;</span><span class="p">:</span>
            <span class="n">handle</span> <span class="o">=</span> <span class="n">spiceypy</span><span class="o">.</span><span class="n">dasopw</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">BaseException</span>

    <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">!=</span> <span class="n">endianness</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;-- The binary kernel is </span><span class="si">{</span><span class="n">endianness</span><span class="si">}</span><span class="s2"> endian; this&quot;</span>
                            <span class="sa">f</span><span class="s2">&quot; endianness is not supported by your machine.&quot;</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;   You can use NAIF&#39;s utility BINGO to convert the file.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s2">&quot;The binary kernel is not readable by your machine.&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span> <span class="o">!=</span> <span class="n">endianness</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;The binary kernel is </span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">byteorder</span><span class="si">}</span><span class="s2"> endian; this &quot;</span> \
                    <span class="sa">f</span><span class="s2">&quot;endianness is not the one specified via configuration.&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">arch</span> <span class="o">==</span> <span class="s1">&#39;daf&#39;</span><span class="p">:</span>
                <span class="n">spiceypy</span><span class="o">.</span><span class="n">dafcls</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">arch</span> <span class="o">==</span> <span class="s1">&#39;das&#39;</span><span class="p">:</span>
                <span class="n">spiceypy</span><span class="o">.</span><span class="n">dascls</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">BaseException</span><span class="p">:</span>
            <span class="k">pass</span>

    <span class="k">return</span> <span class="n">error</span></div>


<div class="viewcode-block" id="check_badchar"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.check_badchar">[docs]</a><span class="k">def</span> <span class="nf">check_badchar</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check NON-ASCII characters for a file.</span>

<span class="sd">    :param file: Path to file to check</span>
<span class="sd">    :return: Resulting error messages</span>
<span class="sd">    :rtype: list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">error</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">line_num</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">isascii</span><span class="p">():</span>
                <span class="n">char_count</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">badchars</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">char</span><span class="o">.</span><span class="n">isascii</span><span class="p">():</span>
                        <span class="n">badchars</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">char_count</span><span class="p">)</span>
                    <span class="n">char_count</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">error</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NON-ASCII character(s) in line </span><span class="si">{</span><span class="n">line_num</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
                <span class="n">error</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">badchar_line</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">())</span>
                <span class="k">for</span> <span class="n">badchar</span> <span class="ow">in</span> <span class="n">badchars</span><span class="p">:</span>
                    <span class="n">badchar_line</span> <span class="o">=</span> <span class="n">badchar_line</span><span class="p">[:</span><span class="n">badchar</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;^&quot;</span> <span class="o">+</span> <span class="n">badchar_line</span><span class="p">[</span><span class="n">badchar</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
                <span class="n">error</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">badchar_line</span><span class="p">)</span>
            <span class="n">line_num</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">error</span></div>


<div class="viewcode-block" id="check_eol"><a class="viewcode-back" href="../../../../pds.naif_pds4_bundler.utils.html#pds.naif_pds4_bundler.utils.files.check_eol">[docs]</a><span class="k">def</span> <span class="nf">check_eol</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">eol</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Check file EOL.</span>

<span class="sd">    :param file: Path to file to check</span>
<span class="sd">    :param eol: Expected End of Line</span>
<span class="sd">    :return: Resulting error messages</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">error</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">open_file</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">open_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">eol</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="sa">b</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s2">&quot;Incorrect EOL in file, LF (</span><span class="se">\\</span><span class="s2">n) expected.&quot;</span>
    <span class="k">elif</span> <span class="n">eol</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">content</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\r\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="n">content</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="n">error</span> <span class="o">=</span> <span class="s2">&quot;Incorrect EOL in file, CRLF (</span><span class="se">\\</span><span class="s2">r</span><span class="se">\\</span><span class="s2">n) expected.&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">error_message</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Incorrect EOL in configuration: </span><span class="si">{</span><span class="n">eol</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">error</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021, Caltech/JPL/NASA

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>